<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="page" name="Members">
    <t t-call="website.layout">
        <t t-set="additional_title">Members</t>
        <div id="wrap">
            <div class="oe_structure">
                <section>
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <h1 class="text-center">Our Members Directory</h1>
                                <h3 class="text-muted text-center">Find a business partner</h3>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <div class="container">
            <div class="row">

            <div class="col-lg-3 mb32" id="left_column">
                 <ul class="nav nav-pills flex-column mt16">
                    <li class="nav-header nav-item"><h3>Группы</h3></li>
                    <li class="nav-item"><a href="/members" class="nav-link#{'' if membership_id else ' active'}">All</a></li>
                    <t t-foreach="memberships_data" t-as="membership_data">
                        <t t-if = "membership_data['name'] != 'Free Members' and membership_data['name'] != 'Бесплатные участники'"> 
                            <li class="nav-item">
                                <a t-attf-href=""
                                    t-attf-class="">
                                    <t t-esc="membership_data['name']"/>
                                </a>
                            </li>
                        </t>
                    </t>
                </ul>

                <h3>Теги пользователей</h3>
                <t t-set = "unique_tags" t-value = "[]"/>
                <t t-foreach="memberships_data" t-as="membership_data">
                    <t t-if="membership_data['id'] in memberships_partner_ids">
                        <t t-foreach="memberships_partner_ids[membership_data['id']]" t-as="partner_id">
                        <t t-if = "partner_id in partners" >
                            <t t-set="partner" t-value="partners[partner_id]"/>
                            <t t-foreach="partner.category_id" t-as="tag">
                                <t t-if = "tag['id'] not in unique_tags" >
                                    <li t-if="tag['id']" class="badge bg-primary me-1 p-1 m-1">
                                            <a t-attf-href="/members/tags/add/#{tag['id']}/#{membership_id}"
                                                t-attf-class="nav-link">
                                            <span > <t t-esc="tag['name']"/></span>
                                            </a>
                                    </li>
                                    <t t-set = "unique_tags" t-value = "unique_tags + [tag['id']]"/>
                                </t>
                            </t>
                            </t>
                        </t>
                    </t>
                </t>
                <div>
                    <button class = "btn btn-danger">
                        <a t-attf-href="/members/tags/del"
                            t-attf-class="nav-link">
                            <span style="color:white">Сброс фильтров ☒</span>
                        </a>
                    </button>
                </div>

            </div>

        
            <div class="col-lg-8" id="ref_content">
                <div class='d-flex m-2'>
                    <t t-call="website.pager">
                       <t t-set="classname" t-valuef="float-start"/>
                    </t>
                    <form action="" method="get" class="navbar-search ms-auto pagination">
                        <t t-call="website.website_search_box">
                            <t t-set="search" t-value="post.get('search', '')"/>
                        </t>
                    </form>
                </div>
                <div>
                    <t t-if="not memberships_partner_ids">
                        <p>No result found.</p>
                    </t>
                    <t t-foreach="memberships_data" t-as="membership_data">
                        <t t-if = "membership_data['name'] != 'Free Members' and membership_data['name'] != 'Бесплатные участники'"> 
                                <t t-if="memberships_partner_ids.get(membership_data['id'])">
                                    <h3 class="text-center"><span t-esc="membership_data['name']"/></h3>
                                    <t t-foreach="memberships_partner_ids[membership_data['id']]" t-as="partner_id">
                                        <t t-set="partner" t-value="partners[partner_id]"/>
                                        <div class="d-flex mt-3">
                                            <a t-attf-href="/members/#{slug(partner)}"
                                            t-field="partner.avatar_128"
                                            t-options='{"widget": "image", "qweb_img_responsive": False, "class": "o_image_64_cover me-3"}'
                                            ></a>
                                            <div class="flex-grow-1" style="min-height: 64px;">
                                                <a t-attf-href="/members/#{slug(partner)}">
                                                    <span t-field="partner.display_name"/>
                                                </a>
                                                <div t-field="partner.website_short_description"/>
                                                <div> Теги:
                                                    <t t-if="partner.category_id">
                                                        <t t-foreach="partner.category_id" t-as="tag">
                                                            <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100 o_badge badge rounded-pill lh-1 o_tag_color_5">
                                                                <t t-esc="tag.name"/>
                                                            </span>
                                                        </t>
                                                    </t>                                                                                
                                                </div> 
                                            </div>                                                                                                                                                                                                                                                                                                 
                                        </div>
                                    </t>
                                </t>
                            </t>
                    </t>
                </div>
            </div>

                </div>
            </div>
            <div class="oe_structure" id="oe_structure_website_membership_index_1"/>
        </div>
    </t>

</template>

</odoo>
