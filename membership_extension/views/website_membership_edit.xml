<odoo>
    <!-- убрал отображение городов -->
    <template id="website_membership.opt_index_country" name="Location"
        inherit_id="website_membership.index">
        <xpath expr="//div[@id='left_column']/ul[1]/li[1]" position="replace">
            <li class="nav-header nav-item"><h3>Группы</h3></li>
        </xpath>
        
        <xpath expr="//div[@id='left_column']/ul[1]" position="after">
            <h3>Теги пользователей</h3>
            <t t-set = "unique_tags" t-value = "[]"/>
            <t t-foreach="memberships_data" t-as="membership_data">
                <t t-if="membership_data['id'] in memberships_partner_ids">
                    <t t-foreach="memberships_partner_ids[membership_data['id']]" t-as="partner_id">
                    <t t-if = "partner_id in partners" >
                        <t t-set="partner" t-value="partners[partner_id]"/>
                        <t t-foreach="partner.category_id" t-as="tag">
                            <t t-if = "tag['id'] not in unique_tags" >
                                <li t-if="tag['id']" class="badge bg-primary me-1 p-1 m-1">
                                        <a t-attf-href="/members/tags/add/#{tag['id']}/#{membership_id}"
                                            t-attf-class="nav-link">
                                           <span > <t t-esc="tag['name']"/></span>
                                        </a>
                                </li>
                                <t t-set = "unique_tags" t-value = "unique_tags + [tag['id']]"/>
                            </t>
                        </t>
                        </t>
                    </t>
                </t>
            </t>
            <div>
                <button class = "btn btn-danger">
                    <a t-attf-href="/members/tags/del"
                        t-attf-class="nav-link">
                        <span style="color:white">Сброс фильтров ☒</span>
                    </a>
                </button>
            </div>
        </xpath>
    </template>

    <!-- убрал free member из каталога -->
    <template id="member_del" inherit_id = "website_membership.index">
        <xpath expr="//div[hasclass('col-lg-3')]/ul/t" position="replace">
            <t t-foreach="memberships_data" t-as="membership_data">
               <t t-if = "membership_data['name'] != 'Free Members' and membership_data['name'] != 'Бесплатные участники'"> 
                    <li class="nav-item">
                        <a t-attf-href="/members/association/#{ membership_data['id'] }#{current_country and '/country/%s' % slug(current_country) or ''}#{ search }"
                            t-attf-class="nav-link#{membership_id and membership_data['id'] == membership_id and ' active' or ''}">
                            <t t-esc="membership_data['name']"/> <t t-esc="membership_line"/></a>
                    </li>
                </t>
            </t>
        </xpath>
    </template>

    <!-- убрал free member из списка -->
    <template id="member_del_list"  inherit_id = "website_membership.index">
        <xpath expr="//div[hasclass('col-lg-8')]/div[2]/t[2]" position="replace">
            <t t-foreach="memberships_data" t-as="membership_data">
                <t t-if = "membership_data['name'] != 'Free Members' and membership_data['name'] != 'Бесплатные участники'"> 
                        <t t-if="memberships_partner_ids.get(membership_data['id'])">
                            <h3 class="text-center"><span t-esc="membership_data['name']"/></h3>
                            <t t-foreach="memberships_partner_ids[membership_data['id']]" t-as="partner_id">
                                <t t-set="partner" t-value="partners[partner_id]"/>
                                <div class="d-flex mt-3">
                                    <a t-attf-href="/members/#{slug(partner)}"
                                       t-field="partner.avatar_128"
                                       t-options='{"widget": "image", "qweb_img_responsive": False, "class": "o_image_64_cover me-3"}'
                                    ></a>
                                    <div class="flex-grow-1" style="min-height: 64px;">
                                        <a t-attf-href="/members/#{slug(partner)}">
                                            <span t-field="partner.display_name"/>
                                        </a>
                                        <div t-field="partner.website_short_description"/>
                                        <div> Теги:
                                            <t t-if="partner.category_id">
                                                <t t-foreach="partner.category_id" t-as="tag">
                                                    <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100 o_badge badge rounded-pill lh-1 o_tag_color_5">
                                                        <t t-esc="tag.name"/>
                                                    </span>
                                                </t>
                                            </t>                                                                                
                                        </div> 
                                    </div>                                                                                                                                                                                                                                                                                                 
                                </div>
                            </t>
                        </t>
                    </t>
            </t>
        </xpath>
    </template>

     <!-- Добавление тегов в карточку пользователя -->
<template id="website_additional_fields_0" inherit_id="portal.portal_my_details_fields">
    <xpath expr="//div[hasclass('col-12')]" position="before">
        <div t-attf-class="mb-3 #{error.get('category_id') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="category_id">Теги</label>
            
            <!-- Выводим имена тегов со стилем -->
            <div>
                <t t-if="partner.category_id">
                    <t t-foreach="partner.category_id" t-as="tag">
                        <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100 o_badge badge rounded-pill lh-1 o_tag_color_5">
                            <t t-esc="tag.name"/>
                        </span>
                    </t>
                </t>
            </div>
        </div>
    </xpath>
</template>

<!-- изменение структуры краточки участника -->

<template id="website_partner.partner_detail" name="Partner Details">
    <div class="row">
        <div class="col-lg-3">
            <div t-field="partner.avatar_1920" t-options='{
            "widget": "image",
            "preview_image": "avatar_1920", 
            "style": "object-fit: cover; width: 100%; max-width: 300px;", 
            "class": "w-100 mb-2 rounded-3 border"}'/>
        </div>
        <div class="pt16 pb16 col-lg-8 offset-lg-1 o_colored_level">
            <div class="d-flex align-items-center flex-wrap mb-4">
                <div class="flex-grow-1">
                    <h1 id="partner_name" t-field="partner.display_name"/>
                </div>
            </div>
            <t t-if="partner">
                <div t-field="partner.website_description" class="mb-5"/>
            </t>
            <t t-out="right_column or ''"/>

            <div class="d-flex flex-column">
                    <div class="o_wcrm_contact_details">
                        <div t-field="partner.self" t-options='{
                            "widget": "contact",
                            "fields": ["address", "website", "phone", "email"]
                        }'/>
                        <t t-out="left_column or ''"/>
                    </div>
            </div>
        </div>
    </div>
</template>

<!-- добавление тегов в карточку -->
<template id="website_additional_fields_1" inherit_id="website_partner.partner_detail">
    <xpath expr="//div[hasclass('o_wcrm_contact_details')]/div" position="after">
        <div class="row">
            <div class="col-1">
                <p>Теги:</p>
            </div>
            <div class = "col-6"> 
                <t t-if="partner.category_id">
                    <div class= "d-flex flex-wrap gap-1">
                        <t t-foreach="partner.category_id" t-as="tag">
                            <span class = "badge bg-primary me-1">
                                <t t-esc="tag.name"/>
                            </span>
                        </t>
                    </div>
                </t>
            </div>
           
        </div>
    </xpath>
</template>



</odoo>
